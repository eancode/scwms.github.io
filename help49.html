<!Doctype html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	
	<title>动作触发器组件 配置业务组件 帮助文档 WORKFLOW - 沃克福勒 企业软件研发平台 致力于快速开发</title>
	<meta content="NOODP" name="ROBOTS" />
	<meta name="keywords" content="动作触发器组件, 流程节点定义, 业务组件,帮助,文档,help,Document,白皮书,说明书,使用指南,开发指南">
	<meta name="description" content="动作触发器组件 帮助系统 企业软件快速开发平台 总体介绍部分、全篇介绍各类业务组件，如：列表组件、表单组件、数据导入组件、数据导出组件、打印组件、流程相关组件、帮助系统等等组件...">

	<!-- 新 Bootstrap4 核心 CSS 文件 -->
	<link rel="stylesheet" href="static/bootstrap4/css/bootstrap.css">
	<link rel="stylesheet" href="static/css/public.css">
	<link rel="stylesheet" href="static/css/style.css">
	<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
	<script src="static/js/jquery.min.js"></script>
	 
	<!-- bootstrap.bundle.min.js 用于弹窗、提示、下拉菜单，包含了 popper.min.js -->
	<script src="static/js/popper.min.js"></script>
	 
	<!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
	<script src="static/bootstrap4/js/bootstrap.min.js"></script>

</head>
<body>		
	<header id="header" class="">
		<div class="container-fluid p-r">
			<a class="header-logo" title="第9节、动作触发器组件 << 第四章、配置业务组件 << 帮助系统 << 企业软件快速开发平台"  href="index.html"><h1>企业软件快速开发平台</h1></a>		
			<div class="float-right top">	
				<!-- <div class="text-light contact">
					<span class="glyphicon" title="QQ号">QQ：6996899 </span> | <span title="微信号" class="glyphicon glyphicon-phone">微信：18032603709</span>
				</div> -->
				<nav class="navbar navbar-expand-md navbar-dark  d-none d-md-block" id="navBig">
				    <ul class="navbar-nav float-right">
				      <li class="nav-item">
				      	<a class="nav-link disabled" href="help.html">文档</a>
				      </li>
				      <li class="nav-item">
				      	<a class="nav-link active" href="faq.html">FAQ</a>
				      </li>
				      <li class="nav-item">
				      	<a class="nav-link active" href="download.html">下载</a> 
				      </li>
				      <li class="nav-item">
				        <a class="nav-link " href="workf/download.html"> <button type="button" class="btn btn-outline-light btn-xs">进销存</button> </a>
				      </li>    
				    </ul>
				    <div class="clearfix"></div>
				</nav>
				<nav class="navbar navbar-expand-md navbar-dark  d-block d-md-none" id="navSmall">
					  <a class="navbar-brand" href="#"></a>
					  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
					    <span class="navbar-toggler-icon"></span>
					  </button>				  
					  <div class="collapse navbar-collapse" id="collapsibleNavbar">
					    <ul class="navbar-nav bg-info">
					      <li class="nav-item">
					        <a class="nav-link active" href="index.html">首页</a>
					      </li>
					      <li class="nav-item">
					      	<a class="nav-link disabled" href="help.html">文档</a>
					      </li> <li class="nav-item">
				      	<a class="nav-link active" href="faq.html">FAQ</a>
				      </li>
					      <li class="nav-item">
					      	<a class="nav-link active" href="download.html">下载</a> 
					      </li>
					      <li class="nav-item">
					        <a class="nav-link " href="workf/download.html"> <button type="button" class="btn btn-outline-light btn-xs">进销存</button> </a>
					      </li>    
					    </ul>
				    </div>
				</nav>
			</div>
		</div>
	</header><!-- /header -->
		<div id="slider">
		<div class="slider_mask">
			<h2 class="mask-title d-none d-md-block">《WORKFLOW-企业软件快速开发平台》<br>调试系统开发使用说明书</h2>
			<h4 class="mask-title d-block d-md-none">《WORKFLOW-企业软件快速开发平台》<br>调试系统开发使用说明书</h4>
			<p></p>
			<div class="mask-btns">
				V 1.1
			</div>			
		</div>		
	</div>
	<div class="list01-title bg-info">
		
		<div class="btn-group">
		  <a class="btn btn-warning text-muted" href="help.html"><i class="glyphicon glyphicon-home"></i></a>
		  <a class="btn btn-warning text-muted" href="help4.html">第四章</a>
		</div>
		
		<h2 class="text-center d-none d-md-block">第9节、流程节点路由动作触发器组件（配置流程节点路由的动作处理脚本）</h2>
		<h3 class="text-center d-block d-md-none">第9节、流程节点路由动作触发器组件（配置流程节点路由的动作处理脚本）</h3>
		
	</div>
	<!--内容-->
	<div class="container-fluid help p-r">
		<div class="row">
			<div class="col col-12 col-md-2">
				<div class="" id="help-nav">
					<ul class="list-group">
						<li class="list-group-item"><a href="#c1">SQL脚本检查</a></li> 
						<li class="list-group-item"><a href="#c2">SQL脚本执行</a></li> 
						<li class="list-group-item"><a href="#c3">Java代码执行</a></li> 
					</ul>
				</div>
			</div>
			<div class="col col-12 col-md-10">
				<div class="help-con">

					<div class="card" id="c0">
						<div class="card-header">工作流节点路由触发器</div>
					    <div class="card-body">
					    	<p>工作流路由触发器是节点之间跳转时处理业务数据的重要接口，一共分两种：1，执行 sql 代码；2，执行 java 代码。同时 sql 又分成 sql 代码检查业务和 sql 执行动作。java 组件同样也同时担负检查和执行业务代 码的双重职责。</p>
					    </div>
					</div><!--/card--> 
					
					
					<div class="card" id="c1">
						<div class="card-header" >配置跳转动作执行 SQL 代码检查业务</div>
					    <div class="card-body">
					    	<p>sql 代码检查业务负责检查 A 节点是否可以跳转到 B 节点，若业务不允许跳转，则返回一个描述问题的字 符串；若允许跳转，则返回一个空字符串。 </p>
					    	<p>例如：销售订单提交到库房发货时，款到发货类型的订单，未收款，款项为 0 元，则不能被提交到库房。 理由是还没有收款。那么，SQL 代码检查业务组件就可以返回“该笔业务未收到款项”的消息。从而不能被提交。 </p>
					    	<p>校验业务的时机又分成两种：1，执行动作之前，检查业务；2，执行动作之后，检查业务； </p>
					    	<p>动作执行之前该笔业务数据还没有入库，因此不能获得该笔业务的 数据，但是可以获得尽可能早的触发时机。而动作执行之后，则可以获得该笔业务以及该笔业务所关联的该流 程实例任务、一并计算获得事后的校验结果。 </p>
					    	<p>校验的 sql 语句可以有很多条。任意一条 sql 返回字符串表示路由跳转失败。而 sql 的执行顺序则是按照 order 字段从小到大的顺序一次执行。 </p>
					    	<p>关于占位符：校验 sql 语句中可以通过占位符的方式获取系统当前的业务数据，以下是 sql 业务检查组件表中字段 sql 值的占位符以及含义：</p>
					    	
					    	<table class="table" id="t43">
						    	<tr>
						    		<td rowspan="2"><b>序<br><br>号</b></td><td colspan="2" class="text-center"><b>关于流程节点路由检查表：windowdb.wf_def_node_route_checkscript.sql 字段中占位符的说明</b></td>
						    	</tr><tr>
						    		<td><b>占位符</b></td><td><b>说明</b></td>
						    	</tr><tr>
					    			<td>1</td><td>${my.id}</td><td>当前登录人 id，关联 windowdb.person.id</td>
								</tr><tr>
									<td>2</td><td>${routeId}</td><td>路由 ID，关联 windowdb.wf_def_node_route.id</td>
								</tr><tr>
									<td>3</td><td>${ins_id}</td><td>流程实例 ID，关联 windowdb.wf_ins.id</td>
								</tr><tr>
									<td>4</td><td> ${task_insert_time}</td><td>该任务的创建时间，获取 windowdb.wf_ins_task.insert_time</td>
								</tr><tr>
									<td>5</td><td>${wf_def_id}</td><td>流程定义 ID，关联 windowdb.wf_def.id</td>
								</tr><tr>
									<td>6</td><td> ${from_node_index}</td><td> 来源节点的 index，关联 windowdb.wf_def_node.index </td>
								</tr><tr>
									<td>7</td><td> ${from_node_timeliness}</td><td> 来源节点的受理时限，关联 windowdb.wf_def_node.timeliness </td>
								</tr><tr>
									<td>8</td><td> ${from_node_type}</td><td> 来源节点的类型，关联 windowdb.wf_def_node.node_type </td>
								</tr><tr>
									<td>9</td><td>${from_node_id}</td><td> 来源节点的 ID，关联 windowdb.wf_def_node.id </td>
								</tr><tr>
									<td>10</td><td>${to_node_index}</td><td>目标节点的 index，关联 windowdb.wf_def_node.index </td>
								</tr><tr>
									<td>11</td><td>${to_node_type}</td><td>目标节点的类型，关联 windowdb.wf_def_node.node_type </td>
								</tr><tr>
									<td>12</td><td>${to_node_id}</td><td>目标节点的 ID，关联 windowdb.wf_def_node.id</td>
								</tr> 
								
					    	</table>
					    	 <p class="text-center">表 43</p>
					    	 <p>以下是 sql 业务检查组件表（windowdb.wf_def_node_route_checkscript）的字段说明：</p>
					    	 <table class="table">
						    	<tr>
						    		<td rowspan="2"><b>序<br><br>号</b></td><td colspan="2" class="text-center"><b>流程节点路由表：windowdb.wf_def_node_route_checkscript 字段说明</b></td>
						    	</tr><tr>
						    		<td><b>占位符</b></td><td><b>说明</b></td>
						    	</tr><tr>
					    			<td>1</td><td>id</td><td>主键</td>
						    	</tr><tr>
					    			<td>2</td><td>rid</td><td>路由 ID，关联 windowdb.wf_def_node_route.id </td>
						    	</tr><tr>
					    			<td>3</td><td>order</td><td>SQL 语句执行顺序 </td>
						    	</tr><tr>
					    			<td>4</td><td>sql</td><td>待执行的 SQL 语句 </td>
						    	</tr><tr>
					    			<td>5</td><td>b_a</td><td>before or after ？ 0，动作执行前执行检查；1，动作执行后执行检查；</td>
								</tr>
					    	</table>
					    	 <p class="text-center">表 44</p>
					    	 
					    	 
					    </div>
					</div><!--/card--> 
										

					<div class="card" id="c2">
						<div class="card-header">工作流节点路由触发器-配置流程发生扭转时执行 SQL 代码</div>
					    <div class="card-body">
					    	<p>sql 代码检查执行业务组件负责检查 A 节点跳转到 B 节点的事后，执行批量 SQL 语句，用于处理具体的 业务表数据。 </p>
					    	<p>例如：费用报销财务审批通过时，执行一条 sql 向通知表中写入一行通知信息，通知当事人来财务部门领 款。</p>
					    	<p>关于占位符：执行的 sql 语句中可以通过占位符的方式获取系统当前的业务数据，占位符如<a href="#t42">表 43</a>a>所示。</p>
					    	<p> 以下是 sql 业务执行组件表（windowdb.wf_def_node_route_actionscript）的字段说明：</p>
					    	<table class="table">
						    	<tr>
						    		<td rowspan="2"><b>序<br><br>号</b></td><td colspan="2" class="text-center"><b>流程节点路由表：windowdb.wf_def_node_route_actionscript 字段说明</b></td>
						    	</tr><tr>
						    		<td><b>字段名</b></td><td><b>说明</b></td>
						    	</tr><tr>
					    			<td>1</td><td>id</td><td>主键</td>
						    	</tr><tr>
					    			<td>2</td><td>rid</td><td>路由 ID，关联 windowdb.wf_def_node_route.id </td>
						    	</tr><tr>
					    			<td>3</td><td>order</td><td>SQL 语句执行顺序 </td>
						    	</tr><tr>
					    			<td>4</td><td>sql</td><td>待执行的 SQL 语句 </td>
						    	</tr><tr>
					    			<td>5</td><td>requrnkey</td><td>  sql 返回值；0，无返回值；1，insert 语句返回主键 id；2，select 语句返回字符串</td>
								</tr>
					    	</table>
					    	 <p class="text-center">表 45</p>
					    </div>
					</div><!--/card--> 			

					<div class="card" id="c3">
						<div class="card-header">工作流节点路由触发器-配置流程发生扭转时时执行 Java 代码</div>
					    <div class="card-body">
					    	<p>编写一新的 java 类编译并加载用于处理流程动作扭转发生时的业务。目前已经不建议使用该方法，尽可 能参考本章 9.2 节使用 sql 语句的方式来处理。但是，如果修改数据库中的业务数据已经不能解决问题。例如： 需要调用接口发邮件，调用接口发短信，或者需要调用其它第三方服务、又或者需要调用操作系统底层服务的， 可以考虑阅读本节内容，使用 java 扩展类来处理业务。 代码示例如下所示：</p>
					    	 <small>
					    	 <per>
					    	 	package cn.net.workflow.workflow.route;
					    	 	import java.util.Map;
					    	 	import com.windowdb.wms.dao.WfInsTaskDao;
					    	 	public class RouteManualId{路由ID} extends com.windowdb.wms.service.sup.RouteManual{
					    	 		@Override
					    	 		public void go(WfInsTaskDao dao , Object billId, Map<String,Object> wfInfo ) throws Exception{
					    	 			// FIXME 请此处编写代码处理业务逻辑，可以执行发送短信、邮件以及调用第三方接口或消息。
					    	 			// dao 提供数据库操作服务。
					    	 			// billId 单据编号
					    	 			// wfInfo 流程对象
					    	 			// 注意类名必须以“RouteManualId”作为前缀，后面紧跟一个数字，数字必须是路由ID，执行该路由跳转时才会被调用。
					    	 		}
 					    	 	}
					    	 </per>
					    	 </small>
					    	 <p>注意事项请参考上述代码中的注释内容。</p>
					    </div>
					</div><!--/card--> 
					

				</div><!--/help-con-->
			</div>
		</div>
		
		
		
	</div>
	<!--底部-->
	<div class="container-fluid list03">
		<p class="text-center"><a href="download.html" class="btn btn-outline-light"><span class="glyphicon glyphicon-download mr-10"></span>免费下载试用</a></p>
	</div>
	<footer>
		<div class="footer">
			<div class="copyright">
				©2020-2025 workflow.net.cn
			</div>
			<div class="text-light contact">
				<span class="glyphicon" title="QQ号">QQ：6996899 </span> | <span title="微信号" class="glyphicon glyphicon-phone">微信：18032603709</span>
			</div>
		</div>
	</footer>
	<script src="static/js/public.js" type="text/javascript" charset="utf-8"></script>
</body>
</html>
